# 39 - 集成测试需求

> **版本**: v1.0
> **最后更新**: 2026-01-29
> **依赖文档**: 38-单元测试需求
> **后续文档**: 40-E2E测试需求

---

## 1. 需求概述

实现**集成测试**，验证模块间协作。

**核心目标:**
- **端到端流程**: 完整消息处理流程
- **真实环境**: 接近生产环境配置
- **Docker 测试**: Docker 容器测试

---

## 2. 测试场景

### 2.1 消息流程

```typescript
describe('Message Flow', () => {
  it('should process incoming message', async () => {
    // 1. 接收消息
    const msg = await simulateIncomingMessage({
      text: 'Hello',
      channel: 'telegram',
      userId: '123'
    });

    // 2. 路由到 Agent
    const sessionKey = resolveRoute(msg);

    // 3. Agent 处理
    const reply = await runAgent(sessionKey, msg.text);

    // 4. 验证回复
    expect(reply).toContain('Hello');
  });
});
```

---

**文档完成** ✅
